# DeepFaceLab_Linux через Docker (NixOS)

Этот хелпер упрощает запуск окружения для [DeepFaceLab_Linux](https://github.com/nagadit/DeepFaceLab_Linux) в контейнере Ubuntu на NixOS.

## Ограничения

- Видеокарта: AMD (RX 7900 XTX), поэтому DeepFaceLab работает только в CPU-режиме, без CUDA/ROCм-ускорения.
- Ожидайте очень долгого обучения (часы–дни) даже на мощном CPU.

## Где лежат данные

Модуль создаёт директории (через `systemd-tmpfiles`):

- `~/vid/deepfacelab/repo` — репозиторий DeepFaceLab_Linux и скрипты;
- `~/vid/deepfacelab/data` — датасеты, модели, результаты.

`~/vid` уже привязан к большому разделу `/zero/vid`, поэтому сюда можно безопасно складывать тяжёлые данные.

## Запуск контейнера

- Команда: `deepfacelab-docker`
- По умолчанию:
  - образ: `ubuntu:20.04` (можно переопределить);
  - монтирования:
    - `~/vid/deepfacelab/repo` → `/workspace`;
    - `~/vid/deepfacelab/data` → `/data`;
  - пользователь внутри контейнера совпадает с основным пользователем хоста.

Переменные окружения:

- `DFL_DOCKER_IMAGE` — образ Docker (например, `ubuntu:22.04`);
- `DFL_REPO_DIR` — путь к репозиторию на хосте;
- `DFL_DATA_DIR` — путь к данным на хосте.

Примеры:

- `deepfacelab-docker` — открыть bash в контейнере;
- `DFL_DOCKER_IMAGE=ubuntu:22.04 deepfacelab-docker` — использовать другой образ.

## Дальнейшие шаги внутри контейнера

Дальше следуйте официальному гайду DeepFaceLab_Linux, но уже внутри контейнера:

1. Обновить систему и поставить зависимости (по README репозитория).
2. Клонировать репозиторий:
   - `git clone https://github.com/nagadit/DeepFaceLab_Linux.git /workspace`
3. Выполнить шаги по настройке Python/Conda и установке зависимостей из README.
4. Запускать скрипты DeepFaceLab, используя:
   - `/workspace` для кода;
   - `/data` для датасетов и результатов.

## Типичные проблемы

- Скорость: CPU-режим очень медленный, особенно на высоких разрешениях.
- Память: большие модели могут потребовать десятки гигабайт RAM и swap.
- Docker-группа: пользователь должен быть в группе `docker`, иначе команда потребует `sudo`.

