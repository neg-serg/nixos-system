#!/usr/bin/env bash
set -euo pipefail

msg_file="$1"
subject=$(sed -n '1{s/^[[:space:]]*//;s/[[:space:]]*$//;p;q}' "$msg_file")

# Allow merges, reverts, fixup/squash without bracket check
if [[ "$subject" =~ ^(Merge|Revert|fixup!|squash!)\b ]]; then
  exit 0
fi

if [[ ! "$subject" =~ ^(\[[^][]+\])+[[:space:]] ]]; then
  echo "Commit subject must start with [scope] prefix, e.g. [user/web] ..." >&2
  echo "Got: $subject" >&2
  exit 1
fi

exit 0
